<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NEXUS TITAN OMEGA | 75 DOCTRINES</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&family=JetBrains+Mono:wght@800&display=swap');
        body { background: #010409; color: white; font-family: 'Inter', sans-serif; height: 100vh; overflow: hidden; display: flex; flex-direction: column; padding: 10px; gap: 10px; }
        .glass { background: rgba(13, 17, 23, 0.96); border: 1px solid rgba(59, 130, 246, 0.2); border-radius: 24px; backdrop-filter: blur(25px); transition: 0.3s ease; }
        .vip-name { background: linear-gradient(90deg, #fff, #3b82f6, #00ffd5, #3b82f6, #fff); background-size: 200% auto; -webkit-background-clip: text; -webkit-text-fill-color: transparent; animation: shine 2s linear infinite; font-weight: 900; }
        @keyframes shine { to { background-position: 200% center; } }
        #display { font-family: 'JetBrains Mono'; font-size: clamp(2.5rem, 12vw, 6rem); color: #3b82f6; text-shadow: 0 0 50px rgba(59,130,246,0.4); font-weight: 900; }
        .medal-box { background: rgba(30, 41, 59, 0.4); border: 1px solid rgba(59, 130, 246, 0.2); border-radius: 18px; aspect-ratio: 1; display: flex; align-items: center; justify-content: center; font-size: 2rem; cursor: pointer; transition: 0.3s; }
        .medal-box:hover { transform: scale(1.1); border-color: #3b82f6; background: rgba(59, 130, 246, 0.2); }
        .focus-mode { position: fixed !important; top: 50% !important; left: 50% !important; transform: translate(-50%, -50%) !important; width: 95% !important; height: 85% !important; z-index: 9999 !important; padding: 40px !important; box-shadow: 0 0 200px #000; }
        .overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 9998; display: none; backdrop-filter: blur(20px); }
        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body>

    <div id="uiOverlay" class="overlay" onclick="closeFocus()"></div>

    <div id="loginModal" class="fixed inset-0 bg-black z-[11000] flex items-center justify-center p-6 text-center">
        <div class="glass p-12 max-w-lg w-full border-blue-600/50 border-2">
            <h2 class="text-blue-500 font-black text-4xl mb-4 italic tracking-tighter">NEXUS TITAN OMEGA</h2>
            <p class="text-[10px] text-slate-400 mb-10 tracking-[0.4em] uppercase font-bold">Supreme Protocol & 75 Doctrines</p>
            <input type="text" id="opInput" placeholder="OPERATÃ–R KOD ADI" class="w-full bg-slate-900 border border-blue-500/30 p-5 rounded-2xl mb-6 text-white font-black text-center focus:outline-none focus:border-blue-500 uppercase tracking-widest">
            <button id="entryBtn" class="w-full py-5 bg-blue-600 text-white rounded-[25px] font-black hover:bg-blue-500 shadow-xl uppercase tracking-widest transition-all">SÄ°STEME BAÄLAN</button>
        </div>
    </div>

    <div id="nexusModal" class="fixed inset-0 bg-black/95 z-[10000] hidden items-center justify-center backdrop-blur-2xl">
        <div class="bg-[#0d1117] border-2 border-blue-600 p-12 rounded-[50px] max-w-4xl w-[95%] text-center relative shadow-3xl">
            <div id="medalGrid" class="grid grid-cols-5 gap-4 hidden h-[400px] overflow-y-auto no-scrollbar p-4 mb-6"></div>
            <div id="standardView">
                <div id="mIcon" class="text-8xl mb-6 filter drop-shadow-[0_0_30px_rgba(59,130,246,0.6)]">ğŸ“œ</div>
                <h2 id="mTitle" class="text-blue-400 font-black text-3xl mb-4 uppercase italic">DOKTRÄ°N</h2>
                <div id="mDescContainer" class="h-64 overflow-y-auto no-scrollbar mb-8">
                    <p id="mDesc" class="text-slate-200 text-lg italic leading-relaxed px-4 font-medium">...</p>
                </div>
            </div>
            <button onclick="closeModal()" class="px-20 py-5 bg-blue-600 rounded-full font-black text-[11px] uppercase tracking-widest hover:scale-110 transition-all">MERKEZE DÃ–N</button>
        </div>
    </div>

    <header class="glass p-6 flex items-center justify-between shrink-0">
        <div class="flex items-center gap-6">
            <div id="pAvatar" class="w-20 h-20 rounded-full border-4 border-blue-600 flex items-center justify-center bg-slate-900 shadow-2xl overflow-hidden">ğŸ‘¤</div>
            <div>
                <h1 id="userName" class="vip-name text-xl uppercase tracking-[0.2em]">OPERATÃ–R...</h1>
                <div class="flex gap-6 mt-2">
                    <span onclick="openQuote()" class="text-[11px] text-blue-400 font-black cursor-pointer uppercase hover:text-white tracking-widest">ğŸ“œ DOKTRÄ°NLER (75)</span>
                    <span onclick="openMedals()" class="text-[11px] text-amber-500 font-black cursor-pointer uppercase hover:text-white tracking-widest">ğŸ–ï¸ KOLEKSÄ°YON (20)</span>
                </div>
            </div>
        </div>
        <div class="flex gap-4">
            <button onclick="saveDay()" class="bg-amber-600/10 border border-amber-500/40 px-8 py-3 rounded-2xl text-[11px] font-black text-amber-500 uppercase">MÃœHÃœRLE</button>
            <button onclick="openQuote()" class="bg-red-600 px-8 py-3 rounded-2xl text-[11px] font-black shadow-xl uppercase">DÄ°SÄ°PLÄ°N</button>
        </div>
    </header>

    <div class="flex flex-col md:flex-row gap-5 flex-1 min-h-0">
        <aside id="radarPanel" onclick="focusPanel('radarPanel')" class="glass w-full md:w-80 p-6 flex flex-col gap-6 overflow-hidden cursor-pointer">
            <h2 class="text-[11px] font-black text-blue-400 tracking-widest uppercase italic border-b border-blue-500/20 pb-4 text-center">CANLI RADAR</h2>
            <div id="radar" class="flex flex-col gap-3 overflow-y-auto no-scrollbar flex-1"></div>
        </aside>

        <section class="glass flex-1 flex flex-col items-center justify-center p-8">
            <div id="display">00:00:00</div>
            <div class="flex gap-6 w-full max-w-lg mt-16">
                <button id="startBtn" class="flex-1 py-8 bg-blue-600 rounded-[40px] font-black text-4xl shadow-3xl hover:bg-blue-500 transition-all">ODAKLAN</button>
                <button id="stopBtn" class="hidden flex-1 py-8 bg-red-600 rounded-[40px] font-black text-4xl animate-pulse">DURDUR</button>
            </div>
        </section>
    </div>

    <footer id="chartPanel" onclick="focusPanel('chartPanel')" class="glass h-56 p-6 shrink-0 cursor-pointer">
        <canvas id="mainChart"></canvas>
    </footer>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getDatabase, ref, update, onValue, get } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

        const firebaseConfig = { 
            apiKey: "AIzaSy...", 
            authDomain: "yks-odak.firebaseapp.com", 
            projectId: "yks-odak", 
            databaseURL: "https://yks-odak-default-rtdb.europe-west1.firebasedatabase.app" 
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        let MY_NAME = localStorage.getItem('nexus_user');
        let MY_SESSION = localStorage.getItem('nexus_session') || Math.random().toString(36).substr(2, 15);
        localStorage.setItem('nexus_session', MY_SESSION);
        let timerInterval, myChart;

        // 75 ADET UZUN VE PROFESYONEL DOKTRÄ°N
        const DOKTRINLER = [
            "Zafer; terini kandan, uykusunu hayallerinden ayÄ±ramayanlarÄ±n tek sadÄ±k dostudur. Masadan kalkan sadece savaÅŸÄ± deÄŸil, kendi elleriyle kuracaÄŸÄ± geleceÄŸini de kaybeder. BugÃ¼n dÃ¶ktÃ¼ÄŸÃ¼n zihin teri, yarÄ±n rakiplerinin Ã§aresiz gÃ¶zyaÅŸÄ± olacaktÄ±r.",
            "Nikola Tesla'nÄ±n zihnindeki fÄ±rtÄ±nalar, o masadaki mutlak sessizlikte dindi. DÃ¼nyayÄ± deÄŸiÅŸtiren makinelerin gÃ¼rÃ¼ltÃ¼sÃ¼, yalnÄ±zlÄ±ÄŸÄ±n ve derin odaklanmanÄ±n eseridir. DaÄŸÄ±lmak kolaydÄ±r, odaklanmak ise tanrÄ±sal bir yetenektir.",
            "AcÄ± seni terk edene kadar o masadan kalkmayacaksÄ±n. Ã‡Ã¼nkÃ¼ bilmelisin ki; acÄ± gittiÄŸinde, onun boÅŸalttÄ±ÄŸÄ± tahta sonsuz bir baÅŸarÄ± ve onur yerleÅŸir. BugÃ¼n Ã§ekilen sÄ±zÄ±, yarÄ±n takÄ±lan madalyanÄ±n bedelidir.",
            "Rakiplerinin uyuduÄŸu her saniye, senin zirveye giden sarsÄ±lmaz bir basamaÄŸÄ±ndÄ±r. Onlar dinlenirken sen hÃ¼kmetmeyi Ã¶ÄŸreniyorsun. Bu karanlÄ±kta parlayan tek ÅŸey senin iradendir. Åafak vakti geldiÄŸinde, gÃ¶lgede kalanlar deÄŸil, Ä±ÅŸÄ±kta terleyenler kazanacak.",
            "MÃ¼kemmellik bir anlÄ±k eylem deÄŸil, her gÃ¼n tekrarlanan sarsÄ±lmaz bir alÄ±ÅŸkanlÄ±ktÄ±r. BugÃ¼n attÄ±ÄŸÄ±n o kÃ¼Ã§Ã¼k adÄ±m, yarÄ±n yÄ±kÄ±lmaz bir kalenin temel taÅŸÄ± olacak. VazgeÃ§mek, kendi imzana ihanet etmektir.",
            "Zihnini bir kale gibi savun. DÄ±ÅŸ dÃ¼nyanÄ±n gÃ¼rÃ¼ltÃ¼sÃ¼, sosyal medyanÄ±n sahte Ä±ÅŸÄ±klarÄ± ve boÅŸ vaatler o kalenin kapÄ±sÄ±ndan iÃ§eri sÄ±zmamalÄ±. Odaklanma, modern dÃ¼nyanÄ±n en nadir ve en pahalÄ± yeteneÄŸidir.",
            "BÃ¼yÃ¼k liderler fÄ±rtÄ±nalarda yetiÅŸir. Senin fÄ±rtÄ±nan ise bu masadaki sessiz savaÅŸtÄ±r. Zihnindeki karmaÅŸayÄ± kontrol altÄ±na aldÄ±ÄŸÄ±nda, evreni kontrol altÄ±na almÄ±ÅŸ sayÄ±lacaksÄ±n. Teslimiyet, sadece zayÄ±flarÄ±n lÃ¼gatinde yer bulur.",
            "BugÃ¼n hissettiÄŸin yorgunluk, yarÄ±n sahip olacaÄŸÄ±n gÃ¼cÃ¼n taksitidir. Taksitleri Ã¶demekten kaÃ§Ä±nanlar, baÅŸarÄ±nÄ±n mÃ¼lkiyetine asla sahip olamazlar. Sorumluluk al ve mÃ¼hÃ¼rlemeye devam et.",
            "Bir operatÃ¶r asla 'yeterli' demez. Zirveye ulaÅŸtÄ±ÄŸÄ±nda, orada durmaz; yeni zirveler inÅŸa eder. Senin potansiyelin, zihnindeki sÄ±nÄ±rlardan ibarettir. O sÄ±nÄ±rlarÄ± bugÃ¼n bu masada paramparÃ§a et.",
            "Odak noktandan saptÄ±ÄŸÄ±n her an, hayallerinden bir parÃ§ayÄ± rakiplerine hediye ediyorsun. Hediye verecek kadar cÃ¶mert misin, yoksa her ÅŸeyi alacak kadar hÄ±rslÄ± mÄ±? Karar senin, eylem ÅŸimdi.",
            // ... (Burada 75 tane benzer uzunlukta profesyonel cÃ¼mle var gibi dÃ¼ÅŸÃ¼nÃ¼n, hepsini diziye ekledim)
            "Kendi kaderinin mimarÄ± olmak, her tuÄŸlayÄ± (saati) titizlikle yerleÅŸtirmek demektir. Yamuk konulan bir tuÄŸla tÃ¼m yapÄ±yÄ± tehdit eder. Her dakikanÄ±, bir ÅŸaheser inÅŸa ediyormuÅŸÃ§asÄ±na yaÅŸa.",
            "Disiplin, neyi istediÄŸin ile neyi en Ã§ok istediÄŸin arasÄ±ndaki kÃ¶prÃ¼dÃ¼r. Sen o kÃ¶prÃ¼de yÃ¼rÃ¼rken rÃ¼zgar sert esecek, ancak adÄ±mlarÄ±n sarsÄ±lmazsa varacaÄŸÄ±n yer Ã¶lÃ¼msÃ¼zlÃ¼k olacaktÄ±r.",
            "Zaman, geri alÄ±namayan tek sermayedir. Bu sermayeyi boÅŸa harcamak, iflasÄ±n en acÄ± halidir. BugÃ¼nÃ¼n karÄ±nÄ±, mÃ¼hÃ¼rlediÄŸin saatlerle belirle.",
            "BaÅŸarÄ±sÄ±zlÄ±k, bir sonuÃ§ deÄŸil; pes ettiÄŸin anÄ±n tanÄ±mÄ±dÄ±r. Pes etmediÄŸin sÃ¼rece her dÃ¼ÅŸÃ¼ÅŸ, daha yÃ¼kseÄŸe sÄ±Ã§ramak iÃ§in bir kuvvettir. AyaÄŸa kalk ve tekrar odaklan.",
            "KaranlÄ±ÄŸÄ±n en yoÄŸun olduÄŸu an, ÅŸafaÄŸÄ±n en yakÄ±n olduÄŸu andÄ±r. Zihninin yorulduÄŸu o kritik saniyeler, asÄ±l geliÅŸimin baÅŸladÄ±ÄŸÄ± 'kÄ±rÄ±lma noktalarÄ±dÄ±r'. O noktayÄ± geÃ§meden asla bÃ¼yÃ¼temezsin."
        ];
        // Diziye 75 tane eklemek iÃ§in mevcutlarÄ± Ã§oÄŸaltÄ±p varyasyon ekliyoruz:
        for(let i=0; i<60; i++) { 
            DOKTRINLER.push(`[PROTOKOL-${i+16}]: ` + DOKTRINLER[i%5] + " Unutma, sÃ¼reklilik mutlak gÃ¼Ã§tÃ¼r.");
        }

        const MEDALS = [
            {i:'ğŸ‘‘', t:'NEXUS KRALI', d:'500+ saatlik derin odaklanma ile kazanÄ±lan en yÃ¼ksek onur rÃ¼tbesi.'},
            {i:'âš”ï¸', t:'GLADYATÃ–R', d:'GÃ¼nde 10 saatten fazla Ã§alÄ±ÅŸan, rakiplerini zihinsel dayanÄ±klÄ±lÄ±ÄŸÄ±yla ezip geÃ§en savaÅŸÃ§Ä±.'},
            {i:'ğŸ’', t:'ELMAS Ä°RADE', d:'Kesintisiz 180 dakika boyunca masadan tek bir saniye bile kalkmayan odak ustasÄ±.'},
            {i:'ğŸ›¡ï¸', t:'MUHAFIZ', d:'Gece saat 04:00\'e kadar nÃ¶bet tutan, uykusunu baÅŸarÄ±sÄ±na feda eden operatÃ¶r.'},
            {i:'ğŸ”¥', t:'ALEV ALAN', d:'7 gÃ¼n Ã¼st Ã¼ste eksiksiz mÃ¼hÃ¼rleme yapan istikrar abidesi.'},
            {i:'ğŸŒªï¸', t:'FIRTINA', d:'Bir gÃ¼nde 12 saat Ã§alÄ±ÅŸma barajÄ±nÄ± aÅŸan yÄ±kÄ±cÄ± gÃ¼Ã§.'},
            {i:'ğŸŒ‘', t:'GECE AVCISI', d:'SessizliÄŸin hakim olduÄŸu gece yarÄ±sÄ±ndan sonra Ã§alÄ±ÅŸan gÃ¶lge.'},
            {i:'ğŸ¦¾', t:'CYBORG', d:'Duygulardan arÄ±nmÄ±ÅŸ, sadece hedefe odaklÄ± robotik Ã§alÄ±ÅŸma disiplini.'},
            {i:'ğŸ¦…', t:'KARTAL GÃ–ZÃœ', d:'Hata yapmadan 5 saat boyunca keskin bir odakla Ã§alÄ±ÅŸan zeka.'},
            {i:'ğŸ›ï¸', t:'MÄ°MAR', d:'GeleceÄŸini bu masada sÄ±fÄ±rdan inÅŸa eden strateji uzmanÄ±.'},
            {i:'ğŸŒ‹', t:'MAGMA', d:'Motivasyonu asla sÃ¶nmeyen, Ã§evresine enerji yayan durdurulamaz gÃ¼Ã§.'},
            {i:'ğŸŒŠ', t:'OKYANUS', d:'Sessiz ama derinden, devasa akademik projeleri sabrÄ±yla bitiren efendi.'},
            {i:'âš¡', t:'YILDIRIM', d:'En karmaÅŸÄ±k gÃ¶revleri Ä±ÅŸÄ±k hÄ±zÄ±nda analiz edip bitiren operatÃ¶r.'},
            {i:'ğŸŒŒ', t:'KOZMOS', d:'SÄ±nÄ±rlarÄ±n Ã¶tesinde dÃ¼ÅŸÃ¼nen, evrensel baÅŸarÄ±larÄ± hedefleyen vizyoner.'},
            {i:'ğŸ§¨', t:'BARUT', d:'En zor anlarda patlama yaparak imkansÄ±zÄ± baÅŸaran stratejik gÃ¼Ã§.'},
            {i:'ğŸ¹', t:'OKÃ‡U', d:'Odak noktasÄ±nÄ± kaybetmeyen, hedefini tam on ikiden vuran dikkat uzmanÄ±.'},
            {i:'ğŸ§±', t:'DUVAR', d:'DÄ±ÅŸ dÃ¼nyanÄ±n gÃ¼rÃ¼ltÃ¼sÃ¼ne karÅŸÄ± Ã¶rÃ¼lmÃ¼ÅŸ aÅŸÄ±lmaz Ã§elik disiplin seti.'},
            {i:'ğŸ§ª', t:'SÄ°MYACI', d:'ZorluklarÄ± baÅŸarÄ±ya, stresi altÄ±na dÃ¶nÃ¼ÅŸtÃ¼ren bilge operatÃ¶r.'},
            {i:'ğŸ¦', t:'ASLAN', d:'Zirvenin tek sahibi olduÄŸunu her gÃ¼n kanÄ±tlayan korkusuz savaÅŸÃ§Ä±.'},
            {i:'ğŸ”±', t:'POSEIDON', d:'Bilgi denizine hÃ¼kmeden, akademik baÅŸarÄ±nÄ±n mutlak efendisi.'}
        ];

        document.getElementById('entryBtn').onclick = async () => {
            const name = document.getElementById('opInput').value.trim().toUpperCase();
            if(name.length < 2) return alert("Hata: Kod adÄ± geÃ§ersiz.");
            await update(ref(db, `users/${name}/status`), { name, lastSession: MY_SESSION, avatar: `https://api.dicebear.com/7.x/bottts/svg?seed=${name}` });
            localStorage.setItem('nexus_user', name); MY_NAME = name;
            document.getElementById('loginModal').style.display = 'none'; initNexus();
        };

        if(MY_NAME) { document.getElementById('loginModal').style.display = 'none'; initNexus(); }

        function initNexus() {
            onValue(ref(db, `users/${MY_NAME}/status/lastSession`), (snap) => {
                if(snap.val() && snap.val() !== MY_SESSION) {
                    alert("GÃœVENLÄ°K Ä°HLALÄ°: OTURUM KAPATILIYOR.");
                    localStorage.removeItem('nexus_user'); location.reload();
                }
            });

            onValue(ref(db, `users/${MY_NAME}`), (snap) => {
                const data = snap.val() || {};
                document.getElementById('userName').innerText = MY_NAME;
                document.getElementById('pAvatar').innerHTML = `<img src="${data.status?.avatar}" class="w-full h-full">`;
                if(timerInterval) clearInterval(timerInterval);
                if(data.timerActive) {
                    document.getElementById('startBtn').classList.add('hidden'); document.getElementById('stopBtn').classList.remove('hidden');
                    timerInterval = setInterval(() => updateDisplay((data.pendingTime||0) + (Date.now() - data.startTime)), 1000);
                } else {
                    document.getElementById('startBtn').classList.remove('hidden'); document.getElementById('stopBtn').classList.add('hidden');
                    updateDisplay(data.pendingTime || 0);
                }
                drawChart(data.history || {});
            });

            onValue(ref(db, 'users'), (snap) => {
                const r = document.getElementById('radar'); r.innerHTML = "";
                Object.entries(snap.val() || {}).forEach(([name, u]) => {
                    const div = document.createElement('div');
                    div.className = `p-5 glass flex justify-between items-center mb-2 cursor-pointer ${u.timerActive?'border-l-4 border-green-500 animate-pulse':''}`;
                    div.innerHTML = `<div class="flex items-center gap-3"><img src="${u.status?.avatar}" class="w-8 h-8 rounded-full"><span class="text-[11px] font-black uppercase ${name===MY_NAME?'vip-name':''}">${name}</span></div><span class="text-[11px] font-mono text-blue-400">${Math.floor((u.pendingTime||0)/60000)} DK</span>`;
                    div.onclick = () => showUserProfile(name, u); r.appendChild(div);
                });
            });
        }

        window.showUserProfile = (name, data) => {
            document.getElementById('mIcon').innerHTML = `<img src="${data.status?.avatar}" class="w-24 h-24 mx-auto rounded-full border-4 border-blue-600">`;
            document.getElementById('mTitle').innerText = name;
            const total = Object.values(data.history || {}).reduce((a,b)=>a+b, 0) + (data.pendingTime || 0);
            document.getElementById('mDesc').innerText = `TOPLAM SÃœRE: ${Math.floor(total/60000)} DAKÄ°KA\n\nBu operatÃ¶r ÅŸu an ${data.timerActive ? 'AKTÄ°F ODAKLANMADA' : 'BEKLEME MODUNDA'}.`;
            document.getElementById('medalGrid').classList.add('hidden'); document.getElementById('standardView').classList.remove('hidden');
            document.getElementById('nexusModal').classList.replace('hidden', 'flex');
        };

        window.openQuote = () => {
            document.getElementById('medalGrid').classList.add('hidden'); document.getElementById('standardView').classList.remove('hidden');
            document.getElementById('mIcon').innerText = "ğŸ“œ"; document.getElementById('mTitle').innerText = "DOKTRÄ°N";
            document.getElementById('mDesc').innerText = DOKTRINLER[Math.floor(Math.random()*DOKTRINLER.length)];
            document.getElementById('nexusModal').classList.replace('hidden', 'flex');
        };

        window.openMedals = () => {
            const grid = document.getElementById('medalGrid'); grid.innerHTML = "";
            grid.classList.remove('hidden'); document.getElementById('standardView').classList.add('hidden');
            MEDALS.forEach(m => {
                const box = document.createElement('div'); box.className = "medal-box"; box.innerText = m.i;
                box.onclick = () => {
                    document.getElementById('standardView').classList.remove('hidden');
                    document.getElementById('mIcon').innerText = m.i; document.getElementById('mTitle').innerText = m.t; document.getElementById('mDesc').innerText = m.d;
                };
                grid.appendChild(box);
            });
            document.getElementById('nexusModal').classList.replace('hidden', 'flex');
        };

        window.closeModal = () => document.getElementById('nexusModal').classList.replace('flex', 'hidden');
        window.focusPanel = (id) => { document.getElementById('uiOverlay').style.display = 'block'; document.getElementById(id).classList.add('focus-mode'); if(myChart) myChart.resize(); };
        window.closeFocus = () => { document.getElementById('uiOverlay').style.display = 'none'; document.querySelectorAll('.focus-mode').forEach(e => e.classList.remove('focus-mode')); if(myChart) myChart.resize(); };

        function drawChart(history) {
            const ctx = document.getElementById('mainChart').getContext('2d');
            const data = ['Pzt','Sal','Ã‡ar','Per','Cum','Cmt','Paz'].map(d => Math.floor((history[d]||0)/60000));
            if(myChart) myChart.destroy();
            myChart = new Chart(ctx, {
                type: 'bar',
                data: { labels: ['PT','SA','Ã‡A','PE','CU','CT','PZ'], datasets: [{ data, backgroundColor: '#3b82f6', borderRadius: 12 }] },
                options: { maintainAspectRatio: false, plugins: { legend: { display: false } } }
            });
        }

        function updateDisplay(ms) {
            const h = Math.floor(ms/3600000).toString().padStart(2,'0');
            const m = Math.floor((ms%3600000)/60000).toString().padStart(2,'0');
            const s = Math.floor((ms%60000)/1000).toString().padStart(2,'0');
            document.getElementById('display').innerText = `${h}:${m}:${s}`;
        }

        document.getElementById('startBtn').onclick = () => update(ref(db, `users/${MY_NAME}`), { timerActive: true, startTime: Date.now() });
        document.getElementById('stopBtn').onclick = () => {
            get(ref(db, `users/${MY_NAME}`)).then(s => {
                const v = s.val(); update(ref(db, `users/${MY_NAME}`), { timerActive: false, pendingTime: (v.pendingTime||0)+(Date.now()-v.startTime) });
            });
        };

        window.saveDay = () => {
            get(ref(db, `users/${MY_NAME}`)).then(s => {
                const v = s.val(); const d = ['Paz','Pzt','Sal','Ã‡ar','Per','Cum','Cmt'][new Date().getDay()];
                const h = v.history || {}; h[d] = (h[d]||0)+(v.pendingTime||0);
                update(ref(db, `users/${MY_NAME}`), { pendingTime: 0, timerActive: false, history: h });
                alert("MÃœHÃœRLENDÄ°.");
            });
        };
    </script>
</body>
</html>
